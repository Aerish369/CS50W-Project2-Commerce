{% extends 'auctions/layout.html' %} {% block title %} Active Listings {%endblock %} {% block body %}

<!--See who's the highest Bidder Now for debugging purpuses-->
{% if listing.highest_bid %}
  <h1>{{listing.highest_bid.bid_owner}}</h1>
{% endif %}
{% if listing.highest_bid %}
  <h1>{{listing.highest_bid.bid_amount}}</h1>
{% endif %}

<div class="container">
  <h1>{{listing.title}}</h1>

  {% if listing.category is None %}

  <strong style="border: 1px; border-style: solid; font-size: 12px"
    >Category not set</strong
  >

  {% else %}

  <strong style="border: 1px; border-style: solid; font-size: 12px"
    >{{listing.category}}</strong
  >
  {% endif %}

  <p>{{listing.description}}</p>

  <div class="listingimg">
    <img src="{{listing.image.url}}" alt="{{listing.title}}'s image" />
  </div>

</div>



<!--Bid Section-->
{% if request.user.id ==  listing.owner.id %}
    
    {% if listing.is_active == True %}
      <!--Close Bid-->
      <div class="close-bid">
      <p id="own-listing">You are the owner of this listing and cannot bid on your own listing.</p>
      <form action="{% url 'close-listing' listing.id %}" method="POST">
        {% csrf_token %}
        <input type="submit" value="Close Bid" />
      </form>
    </div>
      {% else %}
      <h3 id="listing-closed-1" >Listing Closed Successfully! 1</h3>
      {% if listing.highest_bid.bid_owner %}
        <h3 id="listing-closed-1" >The Listing is won by {{listing.highest_bid.bid_owner }}</h3>
      {% endif %}

    {% endif %}

  {% elif request.user.is_authenticated %}
    {% if listing.is_active == True %}
    <!--Bidding Box-->
      <form action="" method="POST">
        {% csrf_token %}
        <div style="display: flex" class="bid">
          {% if listing.bid_price is None %}

            <p style="margin-right: 5px" id="dollar">$</p>
            <input
              style="width: 60px"
              maxlength="6"
              type="text"
              value="0"
              name="bid_amount"
            />
            <input type="submit" value="Bid" id="bid-submit" />

            {% else %}
            <p style="margin-right: 5px" id="dollar">$</p>
            <input
              style="width: 60px"
              maxlength="6"
              type="text"
              value="{{listing.bid_price}}"
              name="bid_amount"
            />
            <input type="submit" value="Bid" id="bid-submit" />
          {% endif %}
        </div>
      </form>
      {% else %}
      <h3 id="listing-closed-2">Listing Closed! 2</h3>
    {%endif%}
  
{% endif %}


<!--Winning Bid Logic-->

{% if listing.is_active == False %}

  <div class="win-bid">
  {% if request.user.id == listing.highest_bid.bid_owner.id and listing.highest_bid.bid_owner %}
      <p>
        Congratulations, {{ listing.highest_bid.bid_owner }}! You have won the bid. You can purchase the listed item <a href="#">here</a>
      </p>
    {% elif request.user.is_authenticated == False %}
      <h3 id="listing-closed-3">Listing is closed.</h3>
      <h3 id="listing-closed-3">You can login to see other listings <a href="{% url 'login' %}">here</a>.</h3>
  {% endif %}
  </div>
  

{% endif %}







<!--Save to Watchlist-->
{% comment %}
<input
  type="checkbox"
  checked="checked"
  id="favorite"
  name="favorite-checkbox"
  value="favorite-button"
/>
<label for="favorite" class="favorite">
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="24"
    height="24"
    viewBox="0 0 24 24"
    fill="none"
    stroke="currentColor"
    stroke-width="2"
    stroke-linecap="round"
    stroke-linejoin="round"
    class="feather feather-heart"
  >
    <path
      d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"
    ></path>
  </svg>
  <div class="action">
    <span class="option-1">Add to Favorites</span>
    <span class="option-2">Added to Favorites</span>
  </div>
</label>
{% endcomment %} 


{% endblock %}
